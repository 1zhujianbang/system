# MarketLens 项目升级执行计划 - 阶段一：准备与基础构建

## 阶段目标
建立坚实的数据基础和架构迁移，确保项目兼容最先进工具，为后续阶段打下基础。

## 具体执行计划

## 已完成（阶段一进度更新）
- 数据源文档与实现对齐：GDELT 适配器文档更新为当前实现
- SQLite 作为主存储：以 `data/store.sqlite` 为权威数据源（实体/事件/成员/关系/事件演化边）
- 端到端链路验证：完成 “GDELT 抓取 10 条 → Ollama 云模型抽取 → 入库” 冒烟测试
  - 配置：`KG_STORE_BACKEND=dual`，LLM 走 OpenAI 兼容接口 `http://localhost:11434/v1`
  - 结果：成功抓取 10 条、抽取到 2 条有效事件并写入 SQLite；Neo4j 本地未运行时自动降级写入 SQLite
  - 现象：Ollama 云模型链路存在间歇性 `HTTP 500`（上游 `ollama.com` 连接失败）但重试后可恢复部分请求
- 事件重定向能力：新增事件 ID 解析接口，支持 alias 与 redirect 链解析
- 图谱快照投影：从 SQLite 生成 GE/GET/EE/EE_EVO/EVENT_EVO 五类快照到 `data/snapshots`
- 快照协议与字段校验：固化 nodes/edges/meta 协议并提供校验输出
- 前端快照视图：图谱页新增“快照视图（统一协议）”，可切换 GE/GET/EE 等并一键生成快照
- 图谱查询服务：提供实体/事件查询、实体时间线查询、事件演化边查询与统计
- Neo4j Aura 可选调试：连接验证脚本支持 env 文件与数据库参数（用于可视化/排障）；本机 Docker Neo4j 需要可用的 Docker daemon/权限

## 后续计划（阶段一剩余）
- 将事件重定向解析纳入查询与可视化入口，统一“旧ID/alias → 规范ID”的行为
- 将快照生成纳入运行流程（Run）与审查包（runs）记录，便于回溯与对比
- LLM 增强（GraphRAG/开源模型/偏见检测）延后到后续阶段，优先稳定图谱侧能力

### 1. 数据源整合

已实现（以 GDELT/现有新闻源为主），并完成适配器文档与当前实现对齐

### 2. 存储迁移

#### 2.1 图数据库选型与部署
  - 暂缓：阶段一以 SQLite 为主存储
  - 可选：Neo4j Aura 仅用于可视化与排障（不作为权威数据源）

#### 2.2 数据迁移方案
  - 可选：保留 SQLite → Neo4j 的导入能力作为调试工具链
  - 已修正：迁移脚本对 JSON 字段（数组/字符串）做兼容处理
  - 已验证：可将当前 SQLite 数据导入 Neo4j Aura 测试库并通过计数校验（Entity/Event/参与/关系）

#### 2.3 本体设计
  - 定义本体（Ontology）使用 OWL 框架
  - 明确实体类型（人物、组织等）
  - 设计事件模式（CAMEO 代码）
  - 定义关系类型（"参与"、"影响"等）

### 3. LLM 增强

#### 3.1 GraphRAG 框架集成
  - 集成 Agentic GraphRAG 框架
  - 实现自动化实体抽取功能
  - 开发关系推理模块

#### 3.2 开源模型支持
  - 集成 Llama 3 模型支持
  - 实现多模态输入处理（文本+图像）
  - 优化成本控制机制

#### 3.3 偏见检测机制
  - 实现差分隐私保护机制
  - 开发数据质量检测模块
  - 建立偏见评估指标体系

### 4. 基础知识图谱构建

#### 4.1 实体-事件关系图谱
  - 已实现：GE（Entity-Event 二部图）快照投影与基础查询

#### 4.2 实体-事件时序图谱
  - 已实现：GET（Entity-Event Timeline）快照投影与实体时间线查询

#### 4.3 实体-实体关系图谱
  - 已实现：EE（Entity-Entity 聚合图）快照投影
  - 说明：查询侧以 SQLite/快照协议为主，Cypher 仅作为可选调试方式

## 里程碑交付物
1. GDELT 数据接入模块（已完成）
2. 基础知识图谱投影与查询服务（GE/GET/EE + 扩展快照，已完成）
3. 快照协议统一与前端快照视图（已完成）
4. Neo4j Aura 调试工具链（可选，已完成）
5. LLM 增强方案（延后实施）

## 风险评估与应对措施
- **数据规模挑战**: 使用 Dask 处理大规模数据
- **迁移风险**: 制定详细的数据备份和回滚计划
- **性能瓶颈**: 提前进行压力测试
- **本机 Neo4j 不可用风险**: 默认以 SQLite 为权威存储；Neo4j 仅作为可选调试/可视化目标（推荐 Aura 或确保 Docker daemon 可用）
- **Ollama 云模型稳定性风险**: 上游网络波动会导致间歇性 500；保持重试机制，并在需要时切换到稳定的 OpenAI 兼容云端提供商

## 资源需求
- 云资源: AWS/GCP 计算实例
- 第三方服务: GDELT 数据访问权限
