# README.md

åŸºäºå¤§è¯­è¨€æ¨¡å‹å’ŒçŸ¥è¯†å›¾è°±æ„å»ºçš„æ™ºèƒ½æ–°é—»å¤„ç†ä¸åˆ†æç³»ç»Ÿï¼Œé€šè¿‡å¤šæ™ºèƒ½ä½“åä½œå®ç°ä»"æ–°é—»â†’å®ä½“â†’äº‹ä»¶â†’çŸ¥è¯†å›¾è°±"çš„è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªæ™ºèƒ½çš„æ–°é—»å¤„ç†ä¸åˆ†æç³»ç»Ÿï¼Œé€šè¿‡èåˆå¤šæºæ–°é—»æ•°æ®ï¼Œè‡ªåŠ¨æŠ½å–å®ä½“ã€äº‹ä»¶åŠå…¶å…³è”å…³ç³»ï¼ŒåŠ¨æ€æ„å»ºå¯è§£é‡Šçš„çŸ¥è¯†å›¾è°±ï¼Œå¹¶å®ç°æ™ºèƒ½çš„æ–°é—»å»é‡ã€å®ä½“æ‰©å±•å’ŒçŸ¥è¯†æ¨ç†ï¼Œä¸ºç”¨æˆ·æä¾›ç»“æ„åŒ–çš„æ–°é—»æ´å¯Ÿå’ŒçŸ¥è¯†å‘ç°èƒ½åŠ›ã€‚

### æ ¸å¿ƒç‰¹æ€§
-  **å¤šæºæ–°é—»æ¥å…¥**: æ”¯æŒGNews APIç­‰å¤šæ¸ é“æ–°é—»æº
-  **æ™ºèƒ½å®ä½“æå–**: åŸºäºLLMçš„å®ä½“å’Œäº‹ä»¶è‡ªåŠ¨æŠ½å–
-  **çŸ¥è¯†å›¾è°±æ„å»º**: åŠ¨æ€ç»´æŠ¤å®ä½“-äº‹ä»¶å…³è”ç½‘ç»œ
-  **é«˜æ•ˆå¹¶å‘å¤„ç†**: åŸºäºAsyncExecutorçš„å¼‚æ­¥å¹¶å‘æ¶æ„
-  **æ™ºèƒ½å»é‡**: SimHashç®—æ³•å®ç°æ–°é—»å†…å®¹å»é‡
-  **å¯è§†åŒ–å±•ç¤º**: çŸ¥è¯†å›¾è°±çš„å¯è§†åŒ–å±•ç¤ºï¼ˆå¯é€‰ï¼‰
-  **æ¨¡å—åŒ–æ¶æ„**: è½¯è€¦åˆè®¾è®¡ï¼Œæ”¯æŒçµæ´»æ‰©å±•
-  **æµ‹è¯•é©±åŠ¨**: å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–

### ç³»ç»Ÿæ¶æ„

```
æ–°é—»æº â†’ Agent1(æå–) â†’ Agent2(æ‰©å±•) â†’ Agent3(å›¾è°±æ„å»º)
    â†“         â†“            â†“            â†“
å¤šæºAPI   å®ä½“/äº‹ä»¶æå–  ç›¸å…³æ–°é—»æœç´¢   çŸ¥è¯†å›¾è°±å‹ç¼©
```

### æ ¸å¿ƒæ¶æ„é‡æ„ 

ç³»ç»Ÿå·²å®Œæˆé‡å¤§æ¶æ„é‡æ„ï¼Œå®ç°è½¯è€¦åˆå’Œæ¨¡å—åŒ–ï¼š

- **è§£è€¦è®¾è®¡**: Agentåªè´Ÿè´£æµç¨‹ç¼–æ’ï¼Œä¸šåŠ¡é€»è¾‘å°è£…åœ¨functionsæ¨¡å—
- **ç»Ÿä¸€å·¥å…·å±‚**: utilsæ¨¡å—æä¾›æ ‡å‡†åŒ–çš„æ•°æ®æ“ä½œã€æ–‡ä»¶å¤„ç†ã€LLMè°ƒç”¨ç­‰åŠŸèƒ½
- **å¼‚æ­¥å¢å¼º**: é›†æˆAsyncExecutorå’ŒRateLimiterï¼Œæ”¯æŒé«˜å¹¶å‘å¤„ç†
- **æµ‹è¯•å®Œå¤‡**: ä¸ºæ‰€æœ‰é‡æ„æ¨¡å—æä¾›å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–

### æ ¸å¿ƒåŠŸèƒ½

|åŠŸèƒ½|çŠ¶æ€|æè¿°|
|---|---|---|
|å¤šæºæ–°é—»æ•°æ®æ¥å…¥|âœ…|æ”¯æŒGNews APIç­‰å¤šæ¸ é“æ–°é—»æº|
|æ™ºèƒ½å®ä½“äº‹ä»¶æå–|âœ…|åŸºäºLLMçš„å®ä½“å’Œäº‹ä»¶è‡ªåŠ¨æŠ½å–|
|æ–°é—»å†…å®¹å»é‡|âœ…|SimHashç®—æ³•å®ç°ç²¾ç¡®å»é‡|
|å®ä½“æ‰©å±•æœç´¢|âœ…|æ ¹æ®å®ä½“å…³é”®è¯æ‰©å±•ç›¸å…³æ–°é—»|
|çŸ¥è¯†å›¾è°±æ„å»º|âœ…|åŠ¨æ€ç»´æŠ¤å®ä½“-äº‹ä»¶å…³è”ç½‘ç»œ|
|å¹¶å‘å¼‚æ­¥å¤„ç†|âœ…|åŸºäºAsyncExecutorçš„é«˜æ•ˆå¹¶å‘|
|é…ç½®ç®¡ç†ç³»ç»Ÿ|âœ…|å¤šæ–‡ä»¶é…ç½®æ”¯æŒå’ŒéªŒè¯|
|ç»Ÿä¸€é”™è¯¯å¤„ç†|âœ…|æ ‡å‡†å¼‚å¸¸ç±»å’Œé”™è¯¯å¤„ç†æœºåˆ¶|
|æ¶æ„é‡æ„|âœ…|å®ç°è½¯è€¦åˆçš„æ¨¡å—åŒ–è®¾è®¡|
|æµ‹è¯•è¦†ç›–|âœ…|å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡|
|å¼‚æ­¥æ–‡ä»¶æ“ä½œ|âœ…|åŸå­å†™å…¥å’Œæ–‡ä»¶é”æœºåˆ¶|

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+ï¼Œè¶Šæ–°è¶Šå¥½
- ä¾èµ–åŒ…ï¼šè§ requirements.txt

### å®‰è£…æ­¥éª¤
1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/1zhujianbang/MarketLens.git
cd MarketLens
```

2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

3. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp config/.env.example config/.env.local
# ç¼–è¾‘ config/.env.local é…ç½®APIå¯†é’¥
```

4. è¿è¡Œç³»ç»Ÿ
```bash
streamlit run app.py
```
### å…¸å‹ä½¿ç”¨æµç¨‹

1. **é¦–æ¬¡ä½¿ç”¨**:
   - è®¿é—®ç³»ç»Ÿè®¾ç½®é¡µé¢é…ç½®Agentå‚æ•°
   - åœ¨Pipeline Builderä¸­é…ç½®æ•°æ®æº

2. **æ–°é—»å¤„ç†**:
   - ä½¿ç”¨"æ–°é—»æŠ“å–"æ ‡ç­¾æ‰§è¡Œæ•°æ®é‡‡é›†
   - ç³»ç»Ÿè‡ªåŠ¨æå–å®ä½“å’Œäº‹ä»¶

3. **çŸ¥è¯†æ‹“å±•**:
   - åœ¨"çŸ¥è¯†æ‹“å±•"æ ‡ç­¾ä¸­æ·»åŠ æ„Ÿå…´è¶£çš„å®ä½“
   - æ‰§è¡Œæ‹“å±•ä»»åŠ¡å‘ç°æ›´å¤šç›¸å…³ä¿¡æ¯

4. **ç»“æœæŸ¥çœ‹**:
   - åœ¨DashboardæŸ¥çœ‹å¤„ç†ç»Ÿè®¡
   - ä½¿ç”¨Data Inspectorå’ŒKnowledge Graphæ·±å…¥åˆ†æ


## é¡¹ç›®ç»“æ„

```
news-agent-system/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¡†æ¶ (ä¸“æ³¨ä¸šåŠ¡ç®¡é“)
â”‚   â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ data_utils.py        # æ•°æ®ç®¡é“å’Œè§„èŒƒåŒ–
â”‚   â”‚   â”œâ”€â”€ async_file_utils.py  # å¼‚æ­¥æ–‡ä»¶æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ exceptions.py        # å¼‚å¸¸å¤„ç†
â”‚   â”‚   â”œâ”€â”€ singleton.py         # å•ä¾‹æ¨¡å¼
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ agents/                  # æ™ºèƒ½ä½“æ¨¡å— (ä»…æµç¨‹ç¼–æ’)
â”‚   â”‚   â”œâ”€â”€ agent1.py           # æ–°é—»æå–æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ agent2.py           # å®ä½“æ‰©å±•æ™ºèƒ½ä½“
â”‚   â”‚   â””â”€â”€ agent3.py           # å›¾è°±æ„å»ºæ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ functions/              # ä¸šåŠ¡é€»è¾‘å°è£… (è§£è€¦æ ¸å¿ƒåŠŸèƒ½)
â”‚   â”‚   â”œâ”€â”€ data_fetch.py       # æ•°æ®è·å–å’Œæ‰©å±•
â”‚   â”‚   â”œâ”€â”€ extraction.py       # å®ä½“å’Œäº‹ä»¶æå–
â”‚   â”‚   â”œâ”€â”€ graph_ops.py        # å›¾è°±æ“ä½œå’Œç®¡ç†
â”‚   â”‚   â””â”€â”€ reporting.py        # æŠ¥å‘Šç”Ÿæˆ
â”‚   â””â”€â”€ utils/                  # é€šç”¨å·¥å…·æ¨¡å— (æ ‡å‡†åŒ–æ¥å£)
â”‚       â”œâ”€â”€ json_utils.py       # JSONè§£æå·¥å…·
â”‚       â”œâ”€â”€ file_utils.py       # æ–‡ä»¶å’Œç›®å½•æ“ä½œ
â”‚       â”œâ”€â”€ data_utils.py       # æ•°æ®æŒä¹…åŒ–å’Œåºåˆ—åŒ–
â”‚       â”œâ”€â”€ data_ops.py         # é«˜çº§æ•°æ®æ“ä½œ
â”‚       â”œâ”€â”€ llm_utils.py        # LLMè°ƒç”¨å’Œå¼‚æ­¥æ‰§è¡Œå™¨
â”‚       â””â”€â”€ tool_function.py    # åŸºç¡€å·¥å…·å‡½æ•°
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ base.yaml              # åŸºç¡€é…ç½®
â”‚   â””â”€â”€ agents/                # æ™ºèƒ½ä½“é…ç½®
â”œâ”€â”€ data/                      # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ entities.json          # å®ä½“åº“
â”‚   â”œâ”€â”€ events.json            # äº‹ä»¶åº“
â”‚   â””â”€â”€ knowledge_graph.json   # çŸ¥è¯†å›¾è°±
â”œâ”€â”€ tests/                     # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ test_data_ops.py       # æ•°æ®æ“ä½œæµ‹è¯•
â”‚   â”œâ”€â”€ test_llm_utils.py      # LLMå·¥å…·æµ‹è¯•
â”‚   â”œâ”€â”€ test_async_utils.py    # å¼‚æ­¥å·¥å…·æµ‹è¯•
â”‚   â””â”€â”€ ...
â””â”€â”€ requirements.txt           # ä¾èµ–é…ç½®
```

## éƒ¨ç½²è¯´æ˜

### Dockeréƒ¨ç½² (æ¨è)

ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„Dockerå®¹å™¨åŒ–æ”¯æŒï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§å’Œæ˜“äºéƒ¨ç½²ã€‚

#### ä½¿ç”¨Docker Compose
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/1zhujianbang/MarketLens.git
cd MarketLens

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp config/.env.example config/.env.local
# ç¼–è¾‘config/.env.localé…ç½®APIå¯†é’¥

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. è®¿é—®åº”ç”¨
# æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8501
```

#### å•ç‹¬ä½¿ç”¨Docker
```bash
# æ„å»ºé•œåƒ
docker build -t MarketLens .

# è¿è¡Œå®¹å™¨
docker run -p 8501:8501 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/config:/app/config \
  --env-file config/.env.local \
  news-agent-system
```

#### Docker Composeé…ç½®è¯´æ˜
- **WebæœåŠ¡**: Streamlitåº”ç”¨ (ç«¯å£8501)
- **æ•°æ®æŒä¹…åŒ–**: è‡ªåŠ¨æŒ‚è½½dataå’Œconfigç›®å½•
- **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·æ£€æŸ¥æœºåˆ¶
- **ç¯å¢ƒéš”ç¦»**: å®Œæ•´çš„ç¯å¢ƒéš”ç¦»å’Œä¾èµ–ç®¡ç†

## é…ç½®è¯´æ˜

ç³»ç»Ÿé‡‡ç”¨å¤šæ–‡ä»¶é…ç½®æ¶æ„ï¼š

- `config/base.yaml`: åŸºç¡€é…ç½®
- `config/agents/agent1.yaml`: Agent1é…ç½®
- `config/agents/agent2.yaml`: Agent2é…ç½®
- `config/agents/agent3.yaml`: Agent3é…ç½®


## å¸‚åœºåˆ†ææ™ºèƒ½ä½“

## APIä½¿ç”¨

### æ–°é—»å¤„ç†
```python
from src.agents.agent1 import main as process_news
import asyncio

# è¿è¡Œæ–°é—»å¤„ç†æµç¨‹ (è§£è€¦åçš„Agentè°ƒç”¨)
asyncio.run(process_news())
```

### å®ä½“æ‰©å±•
```python
from src.functions.data_fetch import expand_news_by_recent_entities
import asyncio

# æ ¹æ®å®ä½“æ‰©å±•æ–°é—» (ç›´æ¥è°ƒç”¨ä¸šåŠ¡å‡½æ•°)
result = await expand_news_by_recent_entities(
    keywords=["è‹¹æœå…¬å¸"],
    limit_per_entity=10
)
```

### å›¾è°±æ„å»º
```python
from src.functions.graph_ops import refresh_graph

# åˆ·æ–°çŸ¥è¯†å›¾è°± (ç›´æ¥è°ƒç”¨å›¾è°±æ“ä½œ)
result = refresh_graph()
```

### æ•°æ®æ“ä½œå·¥å…·
```python
from src.utils.data_ops import update_entities, merge_entity_data
from src.utils.llm_utils import AsyncExecutor, RateLimiter

# æ›´æ–°å®ä½“åº“
update_entities(["è‹¹æœå…¬å¸"], ["Apple Inc."], "manual")

# å¼‚æ­¥æ‰§è¡Œå™¨
executor = AsyncExecutor(max_concurrent=10)
results = await executor.run_concurrent_tasks([task1, task2])

# é™é€Ÿå™¨
limiter = RateLimiter(rate_per_sec=5.0)
await limiter.acquire_async()  # è·å–ä»¤ç‰Œ
```

## å¼€å‘æŒ‡å—

### ğŸ—ï¸ æ¶æ„é‡æ„æŒ‡å—

#### å¼€å‘æ¨¡å¼
- **Agentå±‚**: ä»…è´Ÿè´£æµç¨‹ç¼–æ’ï¼Œè°ƒç”¨functionsæ¨¡å—çš„ä¸šåŠ¡é€»è¾‘
- **Functionså±‚**: å°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå®ç°åŠŸèƒ½å¤ç”¨
- **Utilså±‚**: æä¾›æ ‡å‡†åŒ–å·¥å…·å‡½æ•°ï¼Œé¿å…é‡å¤ä»£ç 

#### æ·»åŠ æ–°çš„ä¸šåŠ¡åŠŸèƒ½
1. åœ¨ `src/functions/` ä¸‹åˆ›å»ºä¸šåŠ¡æ¨¡å—
2. ä½¿ç”¨ `src/utils/` ä¸­çš„æ ‡å‡†åŒ–å·¥å…·
3. åœ¨Agentä¸­è°ƒç”¨ä¸šåŠ¡å‡½æ•°è¿›è¡Œç¼–æ’

#### æ·»åŠ æ–°çš„å·¥å…·å‡½æ•°
1. åœ¨ `src/utils/` ä¸‹æ·»åŠ ç›¸åº”çš„å·¥å…·æ¨¡å—
2. æä¾›ç»Ÿä¸€çš„æ¥å£å’Œé”™è¯¯å¤„ç†
3. æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•

### æ·»åŠ æ–°çš„æ™ºèƒ½ä½“
1. ç»§æ‰¿ `BaseAgent` ç±»
2. åœ¨ `_execute_main` ä¸­è°ƒç”¨functionsæ¨¡å—çš„ä¸šåŠ¡é€»è¾‘
3. åœ¨ `AgentManager` ä¸­æ³¨å†Œ

### æ·»åŠ æ–°çš„æ•°æ®æº
1. åœ¨ `src/functions/data_fetch.py` ä¸­å®ç°æ•°æ®è·å–é€»è¾‘
2. ä½¿ç”¨ `src/utils/` ä¸­çš„å·¥å…·è¿›è¡Œæ•°æ®å¤„ç†
3. åœ¨é…ç½®ä¸­æ·»åŠ æ•°æ®æºå®šä¹‰

### æ‰©å±•é…ç½®
1. åœ¨ç›¸åº”é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°é…ç½®é¡¹
2. åœ¨ `ConfigManager` ä¸­æ·»åŠ éªŒè¯é€»è¾‘
3. æ›´æ–°ç±»å‹æ³¨è§£

## ğŸ¨ UIå¼€å‘è§„èŒƒ

### Streamlit Key ç®¡ç†

ä¸ºäº†é˜²æ­¢é‡å¤keyé”™è¯¯ï¼Œé¡¹ç›®é‡‡ç”¨äº†ç»Ÿä¸€çš„Keyç®¡ç†æœºåˆ¶ï¼š

#### ğŸ”§ ä½¿ç”¨Keyç®¡ç†å™¨
```python
from src.core.streamlit_key_manager import get_unique_key, KeyContext

# ç”Ÿæˆå”¯ä¸€key
key = get_unique_key('gnews', 'category', context='config_tab')

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with KeyContext('config_tab'):
    category_key = get_unique_key('gnews', 'category')
    query_key = get_unique_key('gnews', 'query')
```

## è®¸å¯è¯

[Apache License 2.0](LICENSE)

å¦‚æœ‰é—®é¢˜è¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚